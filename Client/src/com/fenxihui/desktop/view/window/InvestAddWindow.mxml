<?xml version="1.0" encoding="utf-8"?>
<component:Window xmlns:fx="http://ns.adobe.com/mxml/2009"
				  xmlns:s="library://ns.adobe.com/flex/spark"
				  xmlns:mx="library://ns.adobe.com/flex/mx"
				  xmlns:component="com.fenxihui.library.component.*"
				  width="600" height="484" creationComplete="initWindow(event)"
				  defaultButton="{btnAddStock}" layout="vertical" maxButtonVisible="false"
				  paddingBottom="20" paddingLeft="20" paddingRight="20" paddingTop="20"
				  resizable="false" title="发布投资组合">
	<fx:Declarations>
		<!-- 将非可视元素（例如服务、值对象）放在此处 -->
	</fx:Declarations>
	<fx:Script>
		<![CDATA[
			import com.fenxihui.desktop.model.User;
			import com.fenxihui.desktop.utils.RemoteProxy;
			
			import mx.collections.ArrayCollection;
			import mx.events.FlexEvent;
			private static var _investAddWindow:InvestAddWindow;
			public static function get investAddWindow():InvestAddWindow{
				if(!_investAddWindow){
					_investAddWindow=new InvestAddWindow;
				}
				return _investAddWindow;
			}
			
			public static function remove():void{
				if(!_investAddWindow)
					return;
				_investAddWindow.nativeWindow.close();
				_investAddWindow.removeAllChildren();
				_investAddWindow.removeAllElements();
				_investAddWindow=null;
			}
			private var isids:Array=[];
			protected function btnAdd_clickHandler(event:MouseEvent):void
			{
				var params:Object={};
				
				params.title=iptTitle.text;
				params.isids=isids.join(',');
				
				RemoteProxy.bind('Invest.Add.Succeed',function(request:XML):void{
					ShowDialog(request.text(),true,function():void{
						remove();
					});
				});
				RemoteProxy.bind('Invest.Add.Failed',function(request:XML):void{
					ShowDialog(request.text(),false,function():void{
						btnAdd.enabled=true;
					});
				});
				btnAdd.enabled=false;
				RemoteProxy.send('Invest.Add',params);
			}

			protected function btnAddStock_clickHandler(event:MouseEvent):void
			{
				var params:Object={};

				params.code=iptCode.text;
				params.name=iptName.text;
				params.reason=iptReason.text;
				params.think=iptThink.text;

				RemoteProxy.bind('Invest.AddStock.Succeed',function(request:XML):void{
					ShowDialog(request.text(),true,function():void{
						params.isid=parseInt(request.@isid.toString());
						isids.push(params.isid);
						dataStockList.addItem(params);
						stockList.dataProvider=dataStockList;
						iptCode.text=iptName.text=iptReason.text=iptThink.text='';
						btnAdd.enabled=btnAddStock.enabled=true;
					});
				});
				RemoteProxy.bind('Invest.AddStock.Failed',function(request:XML):void{
					ShowDialog(request.text(),false,function():void{
						btnAddStock.enabled=true;
					});
				});
				btnAddStock.enabled=false;
				RemoteProxy.send('Invest.AddStock',params);
			}
			
			[Bindable]
			private var dataStockList:ArrayCollection;
			
			protected function initWindow(event:FlexEvent):void
			{
				dataStockList=new ArrayCollection();
				addEventListener(Event.CLOSE,function(e:Event):void{
					remove();
				});
			}
		]]>
	</fx:Script>
	<s:HGroup width="100%" height="30">
		<s:Label width="60" height="100%" text="组合标题：" textAlign="right" verticalAlign="middle"/>
		<mx:TextInput id="iptTitle" width="100%" height="100%"/>
		<mx:Button id="btnAdd" height="100%" label="保存组合" click="btnAdd_clickHandler(event)"
				   enabled="false"/>
	</s:HGroup>
	<mx:HRule width="100%" chromeColor="#000000"/>
	<mx:DataGrid id="stockList" width="100%" height="100%" editable="false" fontSize="12"
				 resizableColumns="true">
		<mx:columns>
			<mx:DataGridColumn dataField="isid" headerText="股票ID" sortable="false" textAlign="center" width="60"/>
			<mx:DataGridColumn dataField="code" headerText="股票代码" sortable="false" textAlign="center" width="60"/>
			<mx:DataGridColumn dataField="name" headerText="股票名称" sortable="false" textAlign="left" width="100"/>
			<mx:DataGridColumn dataField="reason" headerText="选入理由" sortable="false" textAlign="left"/>
			<mx:DataGridColumn dataField="think" headerText="操作思路" sortable="false" textAlign="left"/>
		</mx:columns>
	</mx:DataGrid>
	<mx:HRule width="100%" chromeColor="#000000"/>
	<s:HGroup width="100%" height="30">
		<s:HGroup width="50%" height="30">
			<s:Label width="60" height="100%" text="股票代码：" textAlign="right" verticalAlign="middle"/>
			<s:TextInput id="iptCode" width="80" height="100%" maxChars="6" prompt="000000"
						 restrict="0-9" widthInChars="6"/>
		</s:HGroup>
		<s:HGroup width="50%" height="30">
			<s:Label width="60" height="100%" text="股票名称：" textAlign="right" verticalAlign="middle"/>
			<mx:TextInput id="iptName" width="100%" height="100%"/>
		</s:HGroup>
	</s:HGroup>
	<mx:HRule width="100%" chromeColor="#000000"/>
	<s:HGroup width="100%">
		<s:Label width="60" height="100%" lineHeight="30" paddingBottom="5" paddingTop="5"
				 text="选入理由：" textAlign="right" verticalAlign="top"/>
		<s:TextArea id="iptReason" width="100%" height="75" lineHeight="25"/>
	</s:HGroup>
	<s:HGroup width="100%">
		<s:Label width="60" height="100%" lineHeight="30" paddingBottom="5" paddingTop="5" text="操作思路："
				 textAlign="right" verticalAlign="top"/>
		<s:TextArea id="iptThink" width="100%" height="75" lineHeight="25"/>
	</s:HGroup>
	<s:HGroup width="100%">
	</s:HGroup>
	<s:HGroup width="100%">
	</s:HGroup>
	<s:HGroup width="100%" height="30" horizontalAlign="center" textAlign="left">
		<mx:Button id="btnAddStock" height="100%" label="添加股票" click="btnAddStock_clickHandler(event)"/>
	</s:HGroup>
</component:Window>
